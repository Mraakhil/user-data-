#!/bin/bash
# ===== Update system =====
sudo yum update -y

# ===== Install Java (required for Jenkins) =====
sudo yum install -y java-17-openjdk

# ===== Enable Jenkins repo =====
sudo wget -O /etc/yum.repos.d/jenkins.repo \
    https://pkg.jenkins.io/redhat-stable/jenkins.repo
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key

# ===== Install Jenkins =====
sudo yum install -y jenkins

# ===== Start and enable Jenkins =====
sudo systemctl enable jenkins
sudo systemctl start jenkins

# ===== Adjust firewall (only if firewall is active) =====
if systemctl is-active --quiet firewalld; then
    sudo firewall-cmd --permanent --add-port=8080/tcp
    sudo firewall-cmd --reload
fi

# ===== Print Jenkins initial admin password to log =====
echo "Jenkins initial admin password:" >> /var/log/jenkins_install.log
sudo cat /var/lib/jenkins/secrets/initialAdminPassword >> /var/log/jenkins_install.log
